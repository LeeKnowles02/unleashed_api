<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
      (function(){
        var k = 'unleashed-theme', v;
        try { v = localStorage.getItem(k); } catch (e) {}
        if (v === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
        else if (v === 'system' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.setAttribute('data-theme', 'dark');
      })();
    </script>
    <title>
      {% block title %}
        Unleashed Runner
      {% endblock %}
    </title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
    {% block head %}
    {% endblock %}
  </head>

  <body>
    <div class="app">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-mark"></div>
          <div>
            <div class="brand-title">Unleashed Runner</div>
            <div class="brand-subtitle">Exports & sync</div>
          </div>
        </div>

        <nav class="nav">
          <a href="/" class="{% if active_page == 'dashboard' %}active{% endif %}">Dashboard</a>
          <a href="/exports/sales" class="{% if active_page == 'sales' %}active{% endif %}">Sales & Revenue</a>
          <a href="/exports/customers" class="{% if active_page == 'customers' %}active{% endif %}">Customers & Sales Dimensions</a>
          <a href="/exports/products" class="{% if active_page == 'products' %}active{% endif %}">Products & Cost Foundation</a>
          <a href="/exports/inventory" class="{% if active_page == 'inventory' %}active{% endif %}">Inventory</a>
          <a href="/exports/purchasing" class="{% if active_page == 'purchasing' %}active{% endif %}">Purchasing</a>
          <a href="/ui" class="{% if active_page == 'ui' %}active{% endif %}">UI Showcase</a>
          <a href="/settings" class="{% if active_page == 'settings' %}active{% endif %}">Settings</a>
        </nav>

        <div class="sidebar-options">
          <div class="options-label muted">Options</div>
          <div class="theme-switcher">
            <label class="muted" style="font-size: 12px; font-weight: 600;">Theme</label>
            <div class="theme-buttons" role="group" aria-label="Theme">
              <button type="button" class="theme-btn" data-theme="light" title="Light">Light</button>
              <button type="button" class="theme-btn" data-theme="dark" title="Dark">Dark</button>
              <button type="button" class="theme-btn" data-theme="system" title="System">System</button>
            </div>
          </div>
        </div>
      </aside>

      <main class="main">
        <div class="container">
          {% block content %}
          {% endblock %}
        </div>
      </main>
    </div>

    <script>
      (function() {
        var STORAGE_KEY = 'unleashed-theme';
        function getStored() { try { return localStorage.getItem(STORAGE_KEY); } catch (e) { return null; } }
        function setStored(v) { try { localStorage.setItem(STORAGE_KEY, v); } catch (e) {} }
        function prefersDark() { return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; }
        function applyTheme(value) {
          var resolved = value === 'system' ? (prefersDark() ? 'dark' : 'light') : value;
          document.documentElement.setAttribute('data-theme', resolved);
          document.querySelectorAll('.theme-btn').forEach(function(btn) {
            btn.classList.toggle('active', btn.dataset.theme === value);
          });
        }
        var initial = getStored() || 'light';
        applyTheme(initial);
        window.addEventListener('DOMContentLoaded', function() {
          document.querySelectorAll('.theme-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              var v = btn.dataset.theme;
              setStored(v);
              applyTheme(v);
            });
          });
          if (window.matchMedia) window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
            if (getStored() === 'system') applyTheme('system');
          });
        });
      })();
    </script>
    {% block scripts %}
    {% endblock %}
  </body>
</html>
